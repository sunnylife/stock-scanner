📝 本次运行日志将存储于: backtest_logs/run_20260115_140258.log

============================================================
🚀 组合回测系统 V3 (基于 StrategyEngine)
============================================================
📝 回测日志已准备就绪


🔍 正在扫描 US_STOCK 市场...
  0%|          | 0/127 [00:00<?, ?it/s]  1%|          | 1/127 [00:00<00:28,  4.40it/s]  2%|1         | 2/127 [00:00<00:20,  5.98it/s]  3%|3         | 4/127 [00:00<00:14,  8.40it/s]  5%|4         | 6/127 [00:00<00:12,  9.71it/s]  6%|6         | 8/127 [00:00<00:12,  9.77it/s]  7%|7         | 9/127 [00:01<00:12,  9.61it/s]  8%|7         | 10/127 [00:01<00:12,  9.70it/s]  9%|9         | 12/127 [00:01<00:11,  9.63it/s] 11%|#1        | 14/127 [00:01<00:14,  7.91it/s] 12%|#1        | 15/127 [00:01<00:13,  8.09it/s] 13%|#3        | 17/127 [00:01<00:12,  8.63it/s] 15%|#4        | 19/127 [00:02<00:11,  9.07it/s] 17%|#6        | 21/127 [00:02<00:11,  9.44it/s] 17%|#7        | 22/127 [00:02<00:11,  9.38it/s] 19%|#8        | 24/127 [00:02<00:12,  8.18it/s] 20%|#9        | 25/127 [00:02<00:12,  8.20it/s] 21%|##1       | 27/127 [00:03<00:11,  8.87it/s] 22%|##2       | 28/127 [00:03<00:10,  9.05it/s] 24%|##3       | 30/127 [00:03<00:10,  9.45it/s] 24%|##4       | 31/127 [00:03<00:10,  9.18it/s] 25%|##5       | 32/127 [00:03<00:10,  8.90it/s] 27%|##6       | 34/127 [00:03<00:11,  7.92it/s] 28%|##7       | 35/127 [00:04<00:11,  8.16it/s] 29%|##9       | 37/127 [00:04<00:10,  8.79it/s] 30%|##9       | 38/127 [00:04<00:10,  8.64it/s] 31%|###       | 39/127 [00:04<00:09,  8.86it/s] 31%|###1      | 40/127 [00:04<00:09,  8.99it/s] 33%|###3      | 42/127 [00:04<00:08,  9.64it/s] 34%|###3      | 43/127 [00:04<00:08,  9.46it/s] 35%|###5      | 45/127 [00:05<00:08,  9.95it/s] 37%|###7      | 47/127 [00:05<00:08,  9.84it/s] 38%|###7      | 48/127 [00:05<00:08,  9.72it/s] 39%|###8      | 49/127 [00:05<00:08,  9.55it/s] 40%|####      | 51/127 [00:05<00:07,  9.88it/s] 42%|####1     | 53/127 [00:05<00:07, 10.15it/s] 43%|####3     | 55/127 [00:06<00:07,  9.96it/s] 44%|####4     | 56/127 [00:06<00:07,  9.97it/s] 45%|####4     | 57/127 [00:06<00:07,  9.80it/s] 46%|####5     | 58/127 [00:06<00:07,  9.11it/s] 46%|####6     | 59/127 [00:06<00:07,  8.87it/s] 48%|####8     | 61/127 [00:06<00:06,  9.55it/s] 50%|####9     | 63/127 [00:06<00:06,  9.82it/s] 51%|#####1    | 65/127 [00:07<00:06, 10.22it/s] 53%|#####2    | 67/127 [00:07<00:05, 10.39it/s] 54%|#####4    | 69/127 [00:07<00:05, 10.41it/s] 56%|#####5    | 71/127 [00:07<00:05, 10.41it/s] 57%|#####7    | 73/127 [00:07<00:05, 10.12it/s] 59%|#####9    | 75/127 [00:08<00:06,  8.57it/s] 60%|#####9    | 76/127 [00:08<00:06,  8.49it/s] 61%|######    | 77/127 [00:08<00:05,  8.62it/s] 61%|######1   | 78/127 [00:08<00:05,  8.32it/s] 62%|######2   | 79/127 [00:08<00:05,  8.23it/s] 63%|######2   | 80/127 [00:08<00:07,  6.56it/s] 64%|######3   | 81/127 [00:09<00:06,  7.06it/s] 65%|######4   | 82/127 [00:09<00:07,  6.40it/s] 66%|######6   | 84/127 [00:09<00:05,  7.77it/s] 67%|######6   | 85/127 [00:09<00:05,  8.18it/s] 68%|######7   | 86/127 [00:09<00:05,  8.19it/s] 69%|######9   | 88/127 [00:09<00:04,  9.01it/s] 70%|#######   | 89/127 [00:09<00:04,  9.02it/s] 71%|#######   | 90/127 [00:10<00:04,  9.16it/s] 72%|#######2  | 92/127 [00:10<00:03,  9.83it/s] 74%|#######4  | 94/127 [00:10<00:03, 10.26it/s] 76%|#######5  | 96/127 [00:10<00:03,  9.80it/s] 76%|#######6  | 97/127 [00:10<00:03,  9.79it/s] 77%|#######7  | 98/127 [00:10<00:03,  7.92it/s] 78%|#######7  | 99/127 [00:11<00:03,  7.70it/s] 79%|#######8  | 100/127 [00:11<00:03,  8.12it/s] 80%|#######9  | 101/127 [00:11<00:03,  8.46it/s] 80%|########  | 102/127 [00:11<00:03,  8.28it/s] 81%|########1 | 103/127 [00:11<00:02,  8.43it/s] 82%|########1 | 104/127 [00:11<00:02,  8.43it/s] 83%|########2 | 105/127 [00:11<00:02,  8.74it/s] 83%|########3 | 106/127 [00:11<00:02,  8.94it/s] 85%|########5 | 108/127 [00:12<00:01,  9.86it/s] 87%|########6 | 110/127 [00:12<00:02,  8.33it/s] 87%|########7 | 111/127 [00:12<00:01,  8.39it/s] 89%|########8 | 113/127 [00:12<00:01,  9.47it/s] 91%|######### | 115/127 [00:12<00:01, 10.08it/s] 92%|#########2| 117/127 [00:12<00:00, 10.17it/s] 94%|#########3| 119/127 [00:13<00:00, 10.09it/s] 95%|#########5| 121/127 [00:13<00:00, 10.19it/s] 97%|#########6| 123/127 [00:13<00:00,  9.34it/s] 98%|#########8| 125/127 [00:13<00:00,  9.70it/s] 99%|#########9| 126/127 [00:13<00:00,  9.56it/s]100%|##########| 127/127 [00:14<00:00,  9.39it/s]                                                 ✅ 扫描完成，共 20 只候选股票
📋 候选池: ['UAMY', 'LPTH', 'POET', 'BKKT', 'LUNR', 'UMAC', 'MSTR', 'VKTX', 'CLSK', 'EWTX', 'RDW', 'USAR', 'TGB', 'SOC', 'ORIC', 'PCT', 'ERAS', 'UEC', 'INFY', 'MP']

📥 预加载数据中...
   ✅ Stooq 源下载成功
✅ UAMY 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ LPTH 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ POET 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ BKKT 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ LUNR 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ UMAC 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ MSTR 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ VKTX 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ CLSK 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ EWTX 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ RDW 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ USAR 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ TGB 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ SOC 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ ORIC 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ PCT 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ ERAS 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ UEC 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ INFY 数据加载成功 (124 条)
   ✅ Stooq 源下载成功
✅ MP 数据加载成功 (124 条)
📥 数据加载完成，共 20 只股票


🚀 开始回测 US_STOCK...
============================================================
📅 回测区间: 2025-12-15 至 2026-01-14 (共 21 个交易日)
💰 初始资金: 100,000
============================================================

   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {"market_phase": "震荡期", "action": "HOLD", "confidence": 65, "reason": "20日线走平，价格位于箱体底部附近，威廉指标进入超卖区，但...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 55,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 60,
    "reason": "20日线走平，价格处于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "BUY",
    "confidence": 65,
    "reason": "处于震荡期底部，且出现RS...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 65,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 60,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {"market_phase": "震荡期", "action": "HOLD", "confidence": 65, "reason": "20日线走平，价格位于箱体内部，威廉指标进入超卖区但信号共...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 60,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 60,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "BUY",
    "confidence": 65,
    "reason": "处于震荡期，20日线走平，...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 60,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 65,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {"market_phase": "震荡期", "action": "HOLD", "confidence": 65, "reason": "20日线走平，价格在箱体内部波动，但RSI与威廉指标均处于...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 65,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "BUY",
    "confidence": 65,
    "reason": "处于震荡期底部，且出现超卖...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 65,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 65,
    "reason": "20日线走平，价格在箱体...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 65,
    "reason": "20日线走平，价格位于箱...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 60,
    "reason": "20日线走平，价格在箱体...
   🤖 调用AI模型: deepseek-v3.2, API: https://jeniya.cn/v1
   📥 AI原始响应: {
    "market_phase": "震荡期",
    "action": "HOLD",
    "confidence": 65,
    "reason": "20日线走平，价格位于箱...
✅ [2025-12-15] 买入 BKKT | 价格:10.68 | 数量:3121 | 信心:65
✅ [2025-12-15] 买入 EWTX | 价格:23.94 | 数量:1392 | 信心:65
✅ [2025-12-15] 买入 ORIC | 价格:9.23 | 数量:3612 | 信心:65

❌ 运行时错误: time data '2025-12-15' does not match format '%Y-%m-%d %H:%M:%S'
Traceback (most recent call last):
  File "/home/ad/code/stock/stock-scanner/3.3back/auto_backtest_runner_v3.py", line 440, in main
    runner.run()
  File "/home/ad/code/stock/stock-scanner/3.3back/auto_backtest_runner_v3.py", line 286, in run
    score, reason = self.strategy.calculate_holding_score(
  File "/home/ad/code/stock/stock-scanner/3.3back/strategy_core.py", line 121, in calculate_holding_score
    buy_dt = datetime.strptime(holding_info['buy_date'], '%Y-%m-%d %H:%M:%S')
  File "/home/ad/miniconda3/envs/lh/lib/python3.10/_strptime.py", line 568, in _strptime_datetime
    tt, fraction, gmtoff_fraction = _strptime(data_string, format)
  File "/home/ad/miniconda3/envs/lh/lib/python3.10/_strptime.py", line 349, in _strptime
    raise ValueError("time data %r does not match format %r" %
ValueError: time data '2025-12-15' does not match format '%Y-%m-%d %H:%M:%S'
